## 整体观察

- 整个PDF为一个JSON对象，由一对{}包裹
- 每一页开头以“页码+1.png”为key，该页所有内容在一个包含一个字典的列表中，该页所有文本内容在该字典的键`result`里的键`tables`对应的数组内
- 所有种类的文字都以`tables`对应数组中的一个字典
- 若只为普通文字，`tables.type`为plain，文本信息在`tables.lines.text`里，每一行都是一个JSON对象
- 若为表格，`tables.type`为table_with_line，文本信息在`tables.table_cells.text`里，表格中的每一个单元都是一个JSON对象



## 普通表格

- 原表格: （PDF P10）

![image-20240308111805644](C:\Users\24799\AppData\Roaming\Typora\typora-user-images\image-20240308111805644.png)

- title：十一、 采用公允价值计量的项目

```json
{"text": "十一、采用公允价值计量的项目", "score": 0.999, "type": "text", "position": [262, 1315, 744, 1315, 744, 1357, 262, 1357], "angle": 0, "direction": 1, "handwritten": 0, "char_scores": [0.999, 0.997, 0.997, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999], "char_centers": [[288, 1337], [316, 1336], [355, 1344], [401, 1337], [441, 1337], [473, 1336], [505, 1337], [536, 1337], [568, 1337], [601, 1337], [633, 1337], [664, 1337], [695, 1337], [726, 1337]], "char_positions": [[277, 1323, 300, 1323, 300, 1353, 277, 1353], [300, 1334, 333, 1334, 333, 1337, 300, 1337], [333, 1341, 379, 1341, 379, 1350, 333, 1350], [379, 1322, 427, 1322, 427, 1354, 379, 1354], [427, 1323, 455, 1323, 455, 1353, 427, 1353], [459, 1322, 490, 1322, 490, 1353, 459, 1353], [490, 1322, 521, 1322, 521, 1354, 490, 1354], [521, 1323, 554, 1323, 554, 1354, 521, 1354], [554, 1322, 584, 1322, 584, 1354, 554, 1354], [584, 1323, 618, 1323, 618, 1353, 584, 1353], [618, 1323, 650, 1323, 650, 1353, 618, 1353], [650, 1323, 678, 1323, 678, 1353, 650, 1353], [679, 1323, 712, 1323, 712, 1354, 679, 1354], [716, 1324, 737, 1324, 737, 1353, 716, 1353]], "char_candidates": [["十", "+"], ["一", "ー", "二", "十"], ["、", ",", ".", " "], ["采", "彩"], ["用"], ["公", "分", "价"], ["允", "元", "分", "充"], ["价"], ["值", "値", "植", "直"], ["计", "汁"], ["量"], ["的"], ["项", "顶", "項"], ["目"]], "char_candidates_score": [[0.999, 0.0], [0.997, 0.002, 0.0, 0.0], [0.997, 0.001, 0.0, 0.0], [0.999, 0.0], [0.999], [0.999, 0.0, 0.0], [0.999, 0.0, 0.0, 0.0], [0.999], [0.999, 0.0, 0.0, 0.0], [0.999, 0.0], [0.999], [0.999], [0.999, 0.0, 0.0], [0.999]]}
```

- unit: 单位:元 币种:人民币

```json
{"text": "单位:元 币种:人民币", "score": 0.997, "type": "text", "position": [1244, 1407, 1596, 1407, 1596, 1447, 1244, 1447], "angle": 0, "direction": 1, "handwritten": 0, "char_scores": [0.999, 0.999, 0.999, 0.999, 0.972, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999], "char_centers": [[1266, 1427], [1294, 1428], [1326, 1434], [1356, 1428], [1390, 1427], [1419, 1428], [1450, 1428], [1485, 1434], [1516, 1428], [1547, 1428], [1578, 1428]], "char_positions": [[1255, 1413, 1279, 1413, 1279, 1442, 1255, 1442], [1279, 1413, 1310, 1413, 1310, 1442, 1279, 1442], [1314, 1428, 1339, 1428, 1339, 1441, 1314, 1441], [1339, 1414, 1373, 1414, 1373, 1442, 1339, 1442], [1373, 1414, 1408, 1414, 1408, 1441, 1373, 1441], [1408, 1413, 1432, 1413, 1432, 1442, 1408, 1442], [1436, 1413, 1467, 1413, 1467, 1442, 1436, 1442], [1470, 1428, 1500, 1428, 1500, 1441, 1470, 1441], [1500, 1413, 1531, 1413, 1531, 1442, 1500, 1442], [1533, 1414, 1561, 1414, 1561, 1442, 1533, 1442], [1564, 1413, 1592, 1413, 1592, 1442, 1564, 1442]], "char_candidates": [["单", "単"], ["位"], [":", ";", ".", " "], ["元"], [" "], ["币"], ["种", "钟", "仲"], [":", ";", " "], ["人"], ["民"], ["币", "市"]], "char_candidates_score": [[0.999, 0.0], [0.999], [0.999, 0.0, 0.0, 0.0], [0.999], [0.972], [0.999], [0.999, 0.0, 0.0], [0.999, 0.0, 0.0], [0.999], [0.999], [0.999, 0.0]]}]}
// 最后一个花括号为plain类型文字的结束，它前面的方括号是lines的结束
```

- header: ['项目名称','期初余额','期末余额','当期变动','对当期利润的影响金额']

```json
{"type": "table_with_line", "position": [270, 1449, 1592, 1449, 1592, 1660, 270, 1660], "table_rows": 4, "table_cols": 5, "height_of_rows": [83, 42, 44, 42], "width_of_cols": [269, 255, 256, 254, 288], "table_cells": [{"start_row": 0, "start_col": 0, "end_row": 0, "end_col": 0, "text": "项目名称", "borders": {"top": 1, "bottom": 1, "left": 1, "right": 1}, "position": [270, 1449, 539, 1449, 539, 1532, 270, 1532], "lines": [{"text": "项目名称", "score": 0.999, "type": "text", "position": [337, 1469, 472, 1469, 472, 1510, 337, 1510], "angle": 0, "direction": 1, "handwritten": 0, "char_scores": [0.999, 0.999, 0.999, 0.999], "char_centers": [[361, 1490], [389, 1490], [420, 1490], [451, 1490]], "char_positions": [[348, 1476, 372, 1476, 372, 1507, 348, 1507], [378, 1477, 400, 1477, 400, 1505, 378, 1505], [406, 1476, 434, 1476, 434, 1505, 406, 1505], [434, 1476, 466, 1476, 466, 1505, 434, 1505]], "char_candidates": [["项", "顶", "項"], ["目"], ["名"], ["称"]], "char_candidates_score": [[0.999, 0.0, 0.0], [0.999], [0.999], [0.999]]}]}
// 项目名称为表格的第一个单元，它是table_cells数组里的第一个JSON对象。table_cells里的对象都以单元的坐标开始，该单元内的完整文本信息在坐标后的“text”中
//单元格内有换行情况的text中会有换行符
```

- key_index: ['交易性金融资产','应收款项融资','合计']
  - key_index为一列，而JSON文件是逐行读取，得想办法看怎么提取
  - 它们是header后每一行的第一个单元格里的文本

- values: [['40,000,000.00','295,728,956.94','255,728,956.94','728,956.94'],['63,515,095.47','4,308,340.26','-59,206,755.21','0'],['103,515,095.47','300,037,297.2','196,522,201.73','728,956.94']]
  - 每一个数组为header后每一行第二个单元格开始的内容

```json
{"start_row": 3, "start_col": 4, "end_row": 3, "end_col": 4, "text": "728,956.94", "borders": {"top": 1, "bottom": 1, "left": 1, "right": 1}, "position": [1304, 1618, 1592, 1618, 1592, 1660, 1304, 1660], "lines": [{"text": "728,956.94", "score": 0.999, "type": "text", "position": [1411, 1619, 1585, 1619, 1585, 1658, 1411, 1658], "angle": 0, "direction": 1, "handwritten": 0, "char_scores": [0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999], "char_centers": [[1430, 1643], [1446, 1643], [1463, 1643], [1479, 1644], [1491, 1643], [1512, 1643], [1524, 1643], [1540, 1646], [1554, 1643], [1571, 1643]], "char_positions": [[1422, 1626, 1439, 1626, 1439, 1660, 1422, 1660], [1439, 1626, 1450, 1626, 1450, 1660, 1439, 1660], [1454, 1626, 1474, 1626, 1474, 1660, 1454, 1660], [1474, 1632, 1485, 1632, 1485, 1660, 1474, 1660], [1485, 1626, 1498, 1626, 1498, 1660, 1485, 1660], [1503, 1626, 1519, 1626, 1519, 1660, 1503, 1660], [1519, 1626, 1530, 1626, 1530, 1660, 1519, 1660], [1533, 1633, 1547, 1633, 1547, 1660, 1533, 1660], [1547, 1626, 1561, 1626, 1561, 1660, 1547, 1660], [1565, 1628, 1578, 1628, 1578, 1660, 1565, 1660]], "char_candidates": [["7"], ["2"], ["8"], [",", "."], ["9"], ["5"], ["6"], [".", ",", "。"], ["9"], ["4"]], "char_candidates_score": [[0.999], [0.999], [0.999], [0.999, 0.0], [0.999], [0.999], [0.999], [0.999, 0.0, 0.0], [0.999], [0.999]]}]}], "lines": []}
// 表格结束之前会有一个和“table_cells”平级的 "lines": []
```



## 跨页表格

- 原表格（PDF P19-P20）

  - 第一页内容

  ![image-20240308120941390](C:\Users\24799\AppData\Roaming\Typora\typora-user-images\image-20240308120941390.png)

  - 第二页内容

  ![image-20240308121022661](C:\Users\24799\AppData\Roaming\Typora\typora-user-images\image-20240308121022661.png)

- PDF中的呈现

![image-20240308121237689](C:\Users\24799\AppData\Roaming\Typora\typora-user-images\image-20240308121237689.png)

- 与普通表格不同的是：
  - 跨页表格被分成了两个表格
  - 表格与表格之间有两行plain类型的文字，一个是表格开始的第一页的页码，一个是后一页开头的“2021年年度报告”



## 多层级表格

- 原表格（PDF P41）

![image-20240308122545092](C:\Users\24799\AppData\Roaming\Typora\typora-user-images\image-20240308122545092.png)

```json
{"start_row": 0, "start_col": 0, "end_row": 1, "end_col": 0, "text": "董事\n姓名", "borders": {"top": 1, "bottom": 1, "left": 1, "right": 1}, "position": [237, 327, 493, 327, 493, 579, 237, 579], "lines": [{"text": "董事", "score": 0.999, "type": "text", "position": [330, 410, 400, 410, 400, 452, 330, 452], "angle": 0, "direction": 1, "handwritten": 0, "char_scores": [0.999, 0.999], "char_centers": [[352, 432], [379, 432]], "char_positions": [[341, 418, 364, 418, 364, 449, 341, 449], [365, 419, 396, 419, 396, 448, 365, 448]], "char_candidates": [["董"], ["事"]], "char_candidates_score": [[0.999], [0.999]]}, {"text": "姓名", "score": 0.999, "type": "text", "position": [326, 455, 400, 455, 400, 491, 326, 491], "angle": 0, "direction": 1, "handwritten": 0, "char_scores": [0.999, 0.999], "char_centers": [[351, 473], [379, 473]], "char_positions": [[337, 459, 365, 459, 365, 487, 337, 487], [365, 459, 393, 459, 393, 487, 365, 487]], "char_candidates": [["姓", "娃"], ["名"]], "char_candidates_score": [[0.999, 0.0], [0.999]]}]}
// 观察到第一个单元格是合并了(0,0),(1,0)两个单元格
```

```json
{"start_row": 0, "start_col": 2, "end_row": 0, "end_col": 7, "text": "参加董事会情况", "borders": {"top": 1, "bottom": 1, "left": 1, "right": 1}, "position": [598, 328, 1441, 328, 1441, 414, 598, 414], "lines": [{"text": "参加董事会情况", "score": 0.999, "type": "text", "position": [907, 351, 1133, 351, 1133, 390, 907, 390], "angle": 0, "direction": 1, "handwritten": 0, "char_scores": [0.999, 0.999, 0.999, 0.999, 0.999, 0.999, 0.999], "char_centers": [[928, 370], [956, 369], [988, 370], [1019, 370], [1050, 370], [1081, 370], [1113, 372]], "char_positions": [[918, 356, 940, 356, 940, 386, 918, 386], [942, 356, 971, 356, 971, 384, 942, 384], [973, 356, 1004, 356, 1004, 386, 973, 386], [1005, 356, 1034, 356, 1034, 386, 1005, 386], [1036, 356, 1067, 356, 1067, 386, 1036, 386], [1067, 356, 1098, 356, 1098, 386, 1067, 386], [1099, 358, 1130, 358, 1130, 386, 1099, 386]], "char_candidates": [["参", "參", "叁"], ["加", "如"], ["董", "懂", "薰", "童", "莗"], ["事"], ["会", "會", "尝"], ["情", "清"], ["况", "況", "沉", "祝"]], "char_candidates_score": [[0.999, 0.0, 0.0], [0.999, 0.0], [0.999, 0.0, 0.0, 0.0, 0.0], [0.999], [0.999, 0.0, 0.0], [0.999, 0.0], [0.999, 0.0, 0.0, 0.0]]}]}
// 观察到该单元格合并了(0,2)至(0,7)六个单元格
```

- 'header':[['董事姓名','是否独立董事','参加董事会情况','参加董事会情况','参加董事会情况','参加董事会情况','参加董事会情况','参加董事会情况','参加股东大会情况'],['董事姓名','是否独立董事','本年应参加董事会次数','亲自出席次数','以通讯方式参加次数','委托出席次数','缺席次数','是否连续两次未亲自参加会议','出席股东大户的次数']]
- 要求输出的header为先行再列逐个坐标输出当前坐标的文本，如*董事姓名* 为两个单元格(0,0),(1,0)的合并，所以在这两个坐标处都要输出 *董事姓名* 这个文本
- 即输出的header矩阵必须每个位置都有元素
- 难点：如何确定表头区域的边界



## 其他case

### 表格跨页+单元格文本跨页+表格嵌套

- 原表格（PDF P20-P22）

  - 第一页

    ![image-20240308122829504](C:\Users\24799\AppData\Roaming\Typora\typora-user-images\image-20240308122829504.png)

  - 第二页

    ![image-20240308122910070](C:\Users\24799\AppData\Roaming\Typora\typora-user-images\image-20240308122910070.png)

    